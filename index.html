<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice PDF Generator</title>
</head>
<body>
    <button onclick="generateInvoice()">Generate Invoice</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Include your custom font here -->
    <script>
		class InvoiceGenerator {
			constructor(options = {}) {
				this.doc = new window.jspdf.jsPDF();
				this.options = {
					companyName: 'McZEN Technologies',
					companyId: '000000',
					primaryColor: '#D00000',
					secondaryColor: '#555555',
					fontSize: {
						small: 10,
						normal: 12,
						large: 16,
						title: 18
					},
					margins: {
						left: 15,
						right: 190,
						top: 20
					}
				};
				Object.assign(this.options, options);
			}

			// Styling and Formatting Utilities
			_setFont(size, color, style = 'normal') {
				this.doc.setFontSize(size);
				this.doc.setTextColor(color);
				this.doc.setFont('Helvetica', style);
			}

			_drawHeader(invoiceNumber, invoiceDate) {
				// Company Name and Logo Space
				this._setFont(this.options.fontSize.title, this.options.primaryColor);
				this.doc.text(this.options.companyName, this.options.margins.left, this.options.margins.top);

				this._setFont(this.options.fontSize.small, this.options.secondaryColor);
				this.doc.text(`Identifiant unique : ${this.options.companyId}`, 
					this.options.margins.left, 
					this.options.margins.top + 8
				);

				// Invoice Title and Number
				this._setFont(this.options.fontSize.large, this.options.primaryColor);
				this.doc.text('FACTURE', this.options.margins.right, this.options.margins.top, { align: 'right' });

				this._setFont(this.options.fontSize.normal, '#000');
				this.doc.text(`# ${invoiceNumber}`, this.options.margins.right, this.options.margins.top + 8, { align: 'right' });
			}

			_drawCustomerDetails(customer) {
				this._setFont(this.options.fontSize.normal, '#000');
				this.doc.text('A:', this.options.margins.left, 45);

				this._setFont(this.options.fontSize.normal, this.options.secondaryColor);
				this.doc.text(customer.name, this.options.margins.left, 53);
				this.doc.text(`Identifiant unique : ${customer.id}`, this.options.margins.left, 60);
			}

			_drawLineItemsHeader() {
				this._setFont(this.options.fontSize.normal, '#000');
				this.doc.setFillColor(230, 230, 230);
				this.doc.rect(10, 100, 190, 10, 'F');
				
				const headers = ['Objet', 'QuantitÃ©', 'Prix unitaire', 'Montant'];
				const positions = [15, 120, 140, 190];
				const alignments = ['left', 'left', 'left', 'right'];

				headers.forEach((header, index) => {
					this.doc.text(header, positions[index], 107, { align: alignments[index] });
				});
			}

			_drawLineItems(items) {
				let y = 117;
				let subtotal = 0;

				items.forEach(item => {
					const total = item.quantity * item.unitPrice;
					subtotal += total;

					this.doc.text(item.objet, 15, y);
					this.doc.text(`${item.quantity}`, 120, y);
					this.doc.text(`${(item.unitPrice / 1000).toFixed(3)} TND`, 140, y);
					this.doc.text(`${(total / 1000).toFixed(3)} TND`, 190, y, { align: 'right' });
					y += 10;
				});

				return { subtotal, y };
			}

			_drawTotals(subtotal, y) {
				const tax = subtotal * 0.19;
				const fiscalStamp = 1000;
				const grandTotal = subtotal + tax + fiscalStamp;

				y += 10;
				this.doc.line(10, y, 200, y);
				y += 5;

				const totalsConfig = [
					{ label: 'Sous-total:', value: subtotal },
					{ label: 'TVA (19%):', value: tax },
					{ label: 'Timbre Fiscal:', value: fiscalStamp }
				];

				totalsConfig.forEach(config => {
					y += 10;
					this.doc.text(config.label, 140, y);
					this.doc.text(`${(config.value / 1000).toFixed(3)} TND`, 190, y, { align: 'right' });
				});

				y += 10;
				this._setFont(this.options.fontSize.large, '#000');
				this.doc.text('Total:', 140, y);
				this._setFont(this.options.fontSize.large, this.options.primaryColor);
				this.doc.text(`${(grandTotal / 1000).toFixed(3)} TND`, 190, y, { align: 'right' });

				return { grandTotal, y };
			}

			_drawFooter(y) {
				this._setFont(this.options.fontSize.small, this.options.secondaryColor);
				this.doc.text('Les conditions de virement bancaire:', 15, y + 20);
				this.doc.text('RIB : 0100 3051 1100 0102 6827', 15, y + 28);
				this.doc.text('au nom de STE MCZEN TECHNOLOGIES', 15, y + 36);
			}

			generateInvoice(customerData, items, invoiceDetails) {
				this._drawHeader(invoiceDetails.number, invoiceDetails.date);
				this._drawCustomerDetails(customerData);
				
				this._setFont(this.options.fontSize.normal, '#000');
				this.doc.text('Date:', this.options.margins.right, 45, { align: 'right' });
				this._setFont(this.options.fontSize.normal, this.options.secondaryColor);
				this.doc.text(invoiceDetails.date, this.options.margins.right, 53, { align: 'right' });

				this._drawLineItemsHeader();
				const { subtotal, y } = this._drawLineItems(items);
				const { y: finalY } = this._drawTotals(subtotal, y);
				this._drawFooter(finalY);

				return this.doc;
			}
		}
		
		// Usage Example
		function generateInvoice() {
			const invoiceGenerator = new InvoiceGenerator();
			const doc = invoiceGenerator.generateInvoice(
				{
					name: 'XXX LLC',
					id: '0000'
				},
				[
					{ 
						objet: 'Renouvellement Nom de domaine', 
						quantity: 1, 
						unitPrice: 14280 
					},
					{ 
						objet: 'Renouvellement Nom de domaine', 
						quantity: 1, 
						unitPrice: 48790 
					}
				],
				{
					number: '015',
					date: '03 Juillet 2024'
				}
			);
			doc.save('facture.pdf');
		}
    </script>
</body>
</html>